extends layout

block content
  // We only expect one message so this is okay to do without a for loop.
  if hasMessages
    - for (var i = 0; i < messages.length; i++) {
      div.alert(class='#{messages[i].type}')
        ul
            li #{messages[i].message}
    - }

  // Head
  .header
    .container
      .row
        .col-md-5
          .card(onClick="start()")
            video#localVideo.smallVideo(autoplay="")
        .col-md-7
          .row
            .title OVERTWIT.CH
          .row
            form.form-inline.form-signup(role="form", action="https://madmimi.com/signups/subscribe/98558", method="post", target="_blank")
              h4.form-signup-heading Join us in our beta. We’re launching soon!
              input.form-control.pull-left(type="email", placeholder="Email address", name="signup[email]", required="", autofocus="")
              input.btn.btn-lg.btn-success.pull-left(type="submit", value="Sign Up" , name="commit")
          .row
            #remoteVideos


  // Features
  .features
    .featurette.feature0
      .container
        .row
          .col-md-4
            h1.featurette-heading ONE CLICK
            p.lead.text-muted add your friends to your stream through the browser, no setup required.
            a.btn.btn-default(href="#",role="button") Learn more »
          .col-md-4.dividers
            h1.featurette-heading STREAM FRIENDS
            p.lead.text-muted add your friends to your stream through the browser, no setup required.
            a.btn.btn-default(href="#",role="button") Learn more »
          .col-md-4
            h1.featurette-heading SWITCH GAMES
            p.lead.text-muted add your friends to your stream through the browser, no setup required.
            a.btn.btn-default(href="#",role="button") Learn more »
    .featurette.feature1
      .container
        .row
          .col-md-7
            h1.featurette-heading Instant setup with OBS
            p.lead or any other broadcast program with an embedded browser (chrome/chromium or firefox)
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="/img/obs-section-bg.png")
    .featurette.feature2
      .container
        .row
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="/img/stream-with-your-friends.jpg")
          .col-md-7
            h1.featurette-heading Stream your friends
            p.lead add your friends to your stream through the browser, no setup required.
    .featurette.feature3
      .container
        .row
          .col-md-7
            h1.featurette-heading Embedded Twitch chat
            p.lead and tweets from your Twitter fans.
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="http://placehold.it/320x320")
    .featurette.feature4
      .container
        .row
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="http://placehold.it/320x320")
          .col-md-7
            h1.featurette-heading Switch from between games seamlessly
            p.lead using the web interface.
    .featurette.feature5
      .container
        .row
          .col-md-7
            h1.featurette-heading Choose from community created skins
            p.lead
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="http://placehold.it/320x320")
    .featurette.feature6
      .container
        .row
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="http://placehold.it/320x320")
          .col-md-7
            h1.featurette-heading Choose from community created skins
            p.lead
    .featurette.feature7
      .container
        .row
          .col-md-7
            h1.featurette-heading Choose from community created skins
            p.lead
          .col-md-5
            img.featurette-image.img-responsive.featurette-img( alt="320x320", src="http://placehold.it/320x320")

  script(src='js/simpleWebRTC.js')
  script.

    //- console.log( $(document).getUrlParam('id') );

    //- // random name
    //- var room =  $(document).getUrlParam('id') || (Math.random() + 1).toString(36).substring(7);

    //- console.log('room',room);
  
    var webrtc = new SimpleWebRTC({
        // the id/element dom element that will hold "our" video
        localVideoEl: 'localVideo',
        // the id/element dom element that will hold remote videos
        remoteVideosEl: 'remoteVideos',
        // immediately ask for camera access
        // disable this for signup page
        autoRequestMedia: false,
      });

      // we have to wait until it's ready
      webrtc.on('readyToCall', function () {
        // you can name it anything
        // this should be randomised for the demo site
        webrtc.joinRoom('blah'); 
      });

      // this is called before the handlePeerStreamAdded() function
      webrtc.on('peerStreamAdded', function (peer) {
      });

      // This gets called when a remote video is added - see handlePeerStreamAdded() function
      webrtc.on('videoAdded', function (video, peer) {
        $(video).parent().addClass("smallCard");
        $(video).parent().append("<img src='/img/hearthstone-card.png'></img>");
        $(video).parent().css("left","1000px");
        $(video).parent().animate({
            left: 0,
          }, {
            duration: 500,
            specialEasing: "easeOutBounce"
          });
        //$(video).addClass("smallVideo");
      });

      var start = function() {
        webrtc.startLocalVideo();
      }

  // /form

//  
  .border
    .webcam
      | <iframe width="100%" height="100%" src="https://apprtc.appspot.com/?r=79067713"></iframe>

